<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Volumetric Display Controller</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0ff;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
        }

        .panel {
            background: #000;
            border: 2px solid #0aa;
            padding: 15px;
            margin-bottom: 15px;
        }

        .panel h3 {
            color: #0ff;
            margin-bottom: 12px;
            font-size: 14px;
            letter-spacing: 1px;
            font-weight: bold;
        }

        .subsection-title {
            color: #0aa;
            font-size: 11px;
            margin: 15px 0 8px 0;
            padding-bottom: 4px;
            border-bottom: 1px solid #0aa;
            font-weight: bold;
        }

        .control-group {
            margin: 10px 0;
        }

        .control-group label {
            display: block;
            margin-bottom: 6px;
            color: #0aa;
            font-size: 12px;
            font-weight: bold;
        }

        .value-display {
            color: #0ff;
            font-weight: bold;
            float: right;
        }

        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 4px;
            background: #0aa;
            outline: none;
            border-radius: 0;
            border: none;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: #0aa;
            border-radius: 0;
            border: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #0aa;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: none;
            margin-top: -7px;
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #0aa;
            cursor: pointer;
            border-radius: 50%;
            border: none;
            box-shadow: none;
        }

        input[type="range"]::-moz-range-track {
            width: 100%;
            height: 4px;
            background: #0aa;
            border: none;
            border-radius: 0;
        }

        input[type="range"]::-ms-track {
            width: 100%;
            height: 4px;
            background: transparent;
            border-color: transparent;
            color: transparent;
        }

        input[type="range"]::-ms-fill-lower {
            background: #0aa;
            border-radius: 0;
        }

        input[type="range"]::-ms-fill-upper {
            background: #0aa;
            border-radius: 0;
        }

        input[type="range"]::-ms-thumb {
            width: 18px;
            height: 18px;
            background: #0aa;
            cursor: pointer;
            border-radius: 50%;
            box-shadow: none;
            border: none;
        }

        input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        select {
            width: 100%;
            padding: 8px;
            background: #000;
            color: #0ff;
            border: 1px solid #0aa;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 11px;
        }

        select:focus {
            outline: none;
            border-color: #0ff;
        }

        button {
            background: #000;
            color: #0ff;
            border: 1px solid #0aa;
            padding: 8px 16px;
            margin: 5px 5px 5px 0;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-weight: normal;
            transition: all 0.2s;
            font-size: 11px;
        }

        button:hover {
            background: #002a2a;
            border-color: #0ff;
        }

        button.active {
            background: #0ff;
            color: #000;
            font-weight: bold;
        }

        #status {
            padding: 15px;
            background: #000;
            border: 2px solid #0aa;
            text-align: center;
            margin-bottom: 15px;
        }

        .status-item {
            display: inline-block;
            margin: 0 15px;
        }

        .status-label {
            color: #0aa;
        }

        .status-value {
            color: #0aa;
            display: inline-block;
            min-width: 80px;
            text-align: left;
        }

        #active-leds {
            min-width: 60px;
        }

        .connected {
            color: #0aa !important;
        }

        .disconnected {
            color: #0aa !important;
            opacity: 0.5;
        }

        .button-group {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
        }

        .button-group button {
            width: 100%;
            aspect-ratio: 2.5 / 1;
            padding: 12px 4px;
            margin: 0;
            min-width: 0;
        }

        /* Three column layout */
        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 1400px) {
            .controls-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        @media (max-width: 900px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Color preset grids - smaller to fit */
        .color-presets-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 6px;
            margin: 8px 0;
        }

        .color-preset-btn {
            width: 100%;
            aspect-ratio: 1;
            padding: 0;
            border: 2px solid #0aa;
            cursor: pointer;
            transition: all 0.2s;
            min-width: 0;
        }

        .color-preset-btn:hover {
            transform: scale(1.1);
            border-color: #0ff;
            box-shadow: 0 0 10px #0ff;
        }

        .color-preset-btn.active {
            border-color: #0ff;
            box-shadow: 0 0 15px #0ff;
            transform: scale(1.05);
        }

        /* Color effect buttons - compact */
        .color-effect-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin: 6px 0;
        }

        .color-effect-btn {
            padding: 10px 6px;
            font-size: 10px;
            background: #000;
            color: #0ff;
            border: 1px solid #0aa;
            margin: 0;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
            text-align: center;
        }

        .color-effect-btn:hover {
            background: #002a2a;
            border-color: #0ff;
        }

        .color-effect-btn.active {
            background: #0ff;
            color: #000;
            font-weight: bold;
        }

        .advanced-effect-btn {
            padding: 10px 6px;
            font-size: 10px;
            background: #000;
            color: #0ff;
            border: 1px solid #0aa;
            margin: 0;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            transition: all 0.2s;
            text-align: center;
        }

        .advanced-effect-btn:hover {
            background: #002a2a;
            border-color: #0ff;
            box-shadow: 0 0 5px rgba(0, 255, 255, 0.3);
        }

        .advanced-effect-btn.active {
            background: #ff00ff;
            color: #000;
            font-weight: bold;
            border-color: #ff00ff;
        }

        .effect-category-title {
            font-size: 9px;
            color: #0ff;
            margin: 12px 0 6px 0;
            opacity: 0.6;
            font-weight: bold;
        }

        /* Scrollable color panel */
        .colors-panel {
            max-height: calc(100vh - 200px);
            overflow-y: auto;
            overflow-x: hidden;
        }

        .colors-panel::-webkit-scrollbar {
            width: 8px;
        }

        .colors-panel::-webkit-scrollbar-track {
            background: #000;
        }

        .colors-panel::-webkit-scrollbar-thumb {
            background: #0aa;
        }

        .colors-panel::-webkit-scrollbar-thumb:hover {
            background: #0ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="status" class="panel">
            <div class="status-item">
                <span class="status-label">Status:</span>
                <span id="connection-status" class="status-value disconnected">Disconnected</span>
            </div>
            <div class="status-item">
                <span class="status-label">FPS:</span>
                <span id="fps" class="status-value">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Active LEDs:</span>
                <span id="active-leds" class="status-value">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Grid:</span>
                <span id="grid-size" class="status-value">0×0×0</span>
            </div>
        </div>

        <div class="controls-grid">
            <!-- COLUMN 1: Global Controls -->
            <div>
                <div class="panel">
                    <h3>Global Controls</h3>

                    <div class="control-group">
                        <label>Animation Speed <span id="animationSpeed-value" class="value-display">1.00</span></label>
                        <input type="range" id="animationSpeed" min="0.1" max="5" step="0.1" value="1.0">
                    </div>

                    <div class="control-group">
                        <label>Color Speed <span id="color-speed-value" class="value-display">1.00</span></label>
                        <input type="range" id="color-speed" min="0.1" max="5" step="0.1" value="1.0">
                    </div>

                    <div class="control-group">
                        <label>Decay / Blur <span id="decay-value" class="value-display">0.00</span></label>
                        <input type="range" id="decay" min="0" max="1" step="0.05" value="0.0">
                    </div>

                    <div class="control-group">
                        <div class="button-group">
                            <button class="effect-btn active" data-param="strobe" data-value="off">Strobe Off</button>
                            <button class="effect-btn" data-param="strobe" data-value="slow">Slow</button>
                            <button class="effect-btn" data-param="strobe" data-value="medium">Med</button>
                            <button class="effect-btn" data-param="strobe" data-value="fast">Fast</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="button-group">
                            <button class="effect-btn active" data-param="pulse" data-value="off">Pulse Off</button>
                            <button class="effect-btn" data-param="pulse" data-value="slow">Slow</button>
                            <button class="effect-btn" data-param="pulse" data-value="medium">Med</button>
                            <button class="effect-btn" data-param="pulse" data-value="fast">Fast</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <label>Scrolling Thickness <span id="scrolling_thickness-value" class="value-display">0</span></label>
                        <input type="range" id="scrolling_thickness" min="0" max="20" step="1" value="0">
                    </div>

                    <div class="control-group">
                        <label>Direction</label>
                        <div class="button-group" style="grid-template-columns: repeat(3, 1fr);">
                            <button class="toggle-btn active" data-param="scrolling_direction" data-value="y">Y</button>
                            <button class="toggle-btn" data-param="scrolling_direction" data-value="x">X</button>
                            <button class="toggle-btn" data-param="scrolling_direction" data-value="z">Z</button>
                            <button class="toggle-btn" data-param="scrolling_direction" data-value="diagonal-xz">Diag XZ</button>
                            <button class="toggle-btn" data-param="scrolling_direction" data-value="diagonal-yz">Diag YZ</button>
                            <button class="toggle-btn" data-param="scrolling_direction" data-value="diagonal-xy">Diag XY</button>
                            <button class="toggle-btn" data-param="scrolling_direction" data-value="radial">Radial</button>
                        </div>
                    </div>

                    <div class="control-group">
                        <div class="button-group" style="grid-template-columns: 1fr 1fr;">
                            <button class="toggle-btn" id="scrolling_invert" data-param="scrolling_invert">Invert Scrolling</button>
                            <button class="toggle-btn" id="invert" data-param="invert">Invert Colors</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COLUMN 2: Scenes -->
            <div>
                <div class="panel">
                    <h3>Scene Selection</h3>
                    <div class="button-group">
                        <button class="scene-btn active" data-scene="shapeMorph">Shape Morph</button>
                        <button class="scene-btn" data-scene="waveField">Wave Field</button>
                        <button class="scene-btn" data-scene="procedural">Procedural</button>
                        <button class="scene-btn" data-scene="particleFlow">Particle Flow</button>
                        <button class="scene-btn" data-scene="rainbow">Rainbow</button>
                    </div>
                </div>

                <div class="panel">
                    <h3>Scene-Specific Parameters</h3>

                    <!-- Shape selector for shapeMorph -->
                    <div class="control-group" id="shape-control">
                        <label>Shape</label>
                        <select id="shape">
                            <option value="sphere">Sphere</option>
                            <option value="helix">Helix</option>
                            <option value="cube">Cube</option>
                            <option value="torus">Torus</option>
                            <option value="pyramid">Pyramid</option>
                        </select>
                    </div>

                    <!-- Wave type selector for waveField -->
                    <div class="control-group" id="waveType-control" style="display: none;">
                        <label>Wave Type</label>
                        <select id="waveType">
                            <option value="ripple">Ripple</option>
                            <option value="plane">Plane</option>
                            <option value="standing">Standing</option>
                            <option value="interference">Interference</option>
                        </select>
                    </div>

                    <!-- Pattern selector for particleFlow -->
                    <div class="control-group" id="pattern-control" style="display: none;">
                        <label>Pattern</label>
                        <select id="pattern">
                            <option value="particles">Particles</option>
                            <option value="spiral">Spiral</option>
                            <option value="explode">Explode</option>
                        </select>
                    </div>
                </div>

                <div class="panel">
                    <h3>Global Scene Parameters</h3>

                    <div class="control-group">
                        <label>Size <span id="size-value" class="value-display">1.00</span></label>
                        <input type="range" id="size" min="0.1" max="3" step="0.1" value="1.0">
                    </div>

                    <div class="control-group">
                        <label>Density <span id="density-value" class="value-display">0.50</span></label>
                        <input type="range" id="density" min="0" max="1" step="0.05" value="0.5">
                    </div>

                    <div class="control-group">
                        <label>Frequency <span id="frequency-value" class="value-display">1.00</span></label>
                        <input type="range" id="frequency" min="0.1" max="5" step="0.1" value="1.0">
                    </div>

                    <div class="control-group">
                        <label>Amplitude <span id="amplitude-value" class="value-display">0.50</span></label>
                        <input type="range" id="amplitude" min="0" max="1" step="0.05" value="0.5">
                    </div>

                    <div class="control-group">
                        <label>Object Count <span id="objectCount-value" class="value-display">1</span></label>
                        <input type="range" id="objectCount" min="1" max="8" step="1" value="1">
                    </div>

                    <div class="subsection-title">Rotation</div>

                    <div class="control-group">
                        <label>Rotation X <span id="rotationX-value" class="value-display">0.00</span></label>
                        <input type="range" id="rotationX" min="-1" max="1" step="0.1" value="0.0">
                    </div>

                    <div class="control-group">
                        <label>Rotation Y <span id="rotationY-value" class="value-display">0.00</span></label>
                        <input type="range" id="rotationY" min="-1" max="1" step="0.1" value="0.0">
                    </div>

                    <div class="control-group">
                        <label>Rotation Z <span id="rotationZ-value" class="value-display">0.00</span></label>
                        <input type="range" id="rotationZ" min="-1" max="1" step="0.1" value="0.0">
                    </div>
                </div>
            </div>

            <!-- COLUMN 3: Colors & Effects -->
            <div>
                <div class="panel colors-panel">
                    <h3>Colors & Effects</h3>

                    <!-- Solid Colors -->
                    <div class="subsection-title">Solid Colors</div>
                    <div class="color-presets-grid">
                        <button class="color-preset-btn active" data-type="single" data-color="#64C8FF" style="background: #64C8FF;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#FF6464" style="background: #FF6464;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#64FF64" style="background: #64FF64;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#FFD700" style="background: #FFD700;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#FF64FF" style="background: #FF64FF;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#00FFFF" style="background: #00FFFF;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#FFFFFF" style="background: #FFFFFF;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#FFA500" style="background: #FFA500;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#9B59B6" style="background: #9B59B6;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#E74C3C" style="background: #E74C3C;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#2ECC71" style="background: #2ECC71;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#3498DB" style="background: #3498DB;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#F39C12" style="background: #F39C12;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#1ABC9C" style="background: #1ABC9C;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#E67E22" style="background: #E67E22;"></button>
                        <button class="color-preset-btn" data-type="single" data-color="#95A5A6" style="background: #95A5A6;"></button>
                    </div>

                    <!-- Preset Gradients -->
                    <div class="subsection-title">Gradients</div>
                    <div class="color-presets-grid">
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#FF0000,#FF00FF,#0000FF" style="background: linear-gradient(135deg, #FF0000 0%, #FF00FF 50%, #0000FF 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#00FFFF,#00FF00,#FFFF00" style="background: linear-gradient(135deg, #00FFFF 0%, #00FF00 50%, #FFFF00 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#FF00FF,#FF0080,#FF00FF" style="background: linear-gradient(135deg, #FF00FF 0%, #FF0080 50%, #FF00FF 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#FFD700,#FFA500,#FF4500" style="background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF4500 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#1E3A8A,#3B82F6,#BFDBFE" style="background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 50%, #BFDBFE 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#7C3AED,#A78BFA,#DDD6FE" style="background: linear-gradient(135deg, #7C3AED 0%, #A78BFA 50%, #DDD6FE 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#059669,#10B981,#86EFAC" style="background: linear-gradient(135deg, #059669 0%, #10B981 50%, #86EFAC 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#DC2626,#F87171,#FECACA" style="background: linear-gradient(135deg, #DC2626 0%, #F87171 50%, #FECACA 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#0891B2,#06B6D4,#A5F3FC" style="background: linear-gradient(135deg, #0891B2 0%, #06B6D4 50%, #A5F3FC 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#EA580C,#FB923C,#FED7AA" style="background: linear-gradient(135deg, #EA580C 0%, #FB923C 50%, #FED7AA 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#BE185D,#EC4899,#FBCFE8" style="background: linear-gradient(135deg, #BE185D 0%, #EC4899 50%, #FBCFE8 100%);"></button>
                        <button class="color-preset-btn" data-type="gradient" data-gradient="#CA8A04,#EAB308,#FEF08A" style="background: linear-gradient(135deg, #CA8A04 0%, #EAB308 50%, #FEF08A 100%);"></button>
                    </div>

                    <!-- Color Mode -->
                    <div class="subsection-title">Color Mode</div>
                    <div class="button-group">
                        <button class="toggle-btn active" data-mode="rainbow" id="color-mode-rainbow">Rainbow</button>
                        <button class="toggle-btn" data-mode="base" id="color-mode-base">Base Color</button>
                    </div>

                    <!-- Basic Color Effects -->
                    <div class="subsection-title">Basic Effects</div>
                    <div class="color-effect-buttons">
                        <button class="color-effect-btn active" data-effect="none">None</button>
                        <button class="color-effect-btn" data-effect="cycle">Cycle</button>
                        <button class="color-effect-btn" data-effect="pulse">Pulse</button>
                        <button class="color-effect-btn" data-effect="wave">Wave</button>
                    </div>

                    <!-- Advanced Color Effects -->
                    <div class="subsection-title">Advanced Effects</div>

                    <!-- Wave Effects -->
                    <div class="effect-category-title">Waves</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="waveMulti">Multi</button>
                        <button class="advanced-effect-btn" data-effect="waveVertical">Vertical</button>
                        <button class="advanced-effect-btn" data-effect="waveCircular">Circular</button>
                        <button class="advanced-effect-btn" data-effect="waveStanding">Standing</button>
                    </div>

                    <!-- Cycle Effects -->
                    <div class="effect-category-title">Cycles</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="cycleHue">Hue</button>
                        <button class="advanced-effect-btn" data-effect="cyclePalette">Palette</button>
                        <button class="advanced-effect-btn" data-effect="cycleComplementary">Complement</button>
                        <button class="advanced-effect-btn" data-effect="cycleTriadic">Triadic</button>
                    </div>

                    <!-- Pulse Effects -->
                    <div class="effect-category-title">Pulses</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="pulseRadial">Radial</button>
                        <button class="advanced-effect-btn" data-effect="pulseAlternating">Alternating</button>
                        <button class="advanced-effect-btn" data-effect="pulseLayered">Layered</button>
                        <button class="advanced-effect-btn" data-effect="pulseBeat">Beat</button>
                    </div>

                    <!-- Static/Noise Effects -->
                    <div class="effect-category-title">Static</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="staticColor">Color</button>
                        <button class="advanced-effect-btn" data-effect="staticDynamic">Dynamic</button>
                        <button class="advanced-effect-btn" data-effect="staticWave">Wave</button>
                    </div>

                    <!-- Combination Effects -->
                    <div class="effect-category-title">Combos</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="pulseWave">PulseWave</button>
                        <button class="advanced-effect-btn" data-effect="cyclePulse">CyclePulse</button>
                        <button class="advanced-effect-btn" data-effect="waveChase">WaveChase</button>
                        <button class="advanced-effect-btn" data-effect="staticCycle">StaticCycle</button>
                        <button class="advanced-effect-btn" data-effect="pulseTrail">PulseTrail</button>
                    </div>

                    <!-- 3D Spatial Effects -->
                    <div class="effect-category-title">3D Spatial</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="diagonalWaves">Diagonal</button>
                        <button class="advanced-effect-btn" data-effect="helix">Helix</button>
                        <button class="advanced-effect-btn" data-effect="vortex">Vortex</button>
                        <button class="advanced-effect-btn" data-effect="tunnel">Tunnel</button>
                    </div>

                    <!-- Procedural Effects -->
                    <div class="effect-category-title">Procedural</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="perlinNoise">Perlin</button>
                        <button class="advanced-effect-btn" data-effect="voronoi">Voronoi</button>
                        <button class="advanced-effect-btn" data-effect="checkerboard3D">Checker</button>
                    </div>

                    <!-- Interference Effects -->
                    <div class="effect-category-title">Interference</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="sineInterferenceXZ">SineXZ</button>
                        <button class="advanced-effect-btn" data-effect="sphericalShellsMoving">Bubbles</button>
                        <button class="advanced-effect-btn" data-effect="cornerExplosion">Corners</button>
                    </div>

                    <!-- Geometric Effects -->
                    <div class="effect-category-title">Geometric</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="depthLayers">Depth</button>
                        <button class="advanced-effect-btn" data-effect="cubeInCube">Cube³</button>
                        <button class="advanced-effect-btn" data-effect="manhattanDistance">Manhattan</button>
                    </div>

                    <!-- Symmetry Effects -->
                    <div class="effect-category-title">Symmetry</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="xzMirror">XZ Mirror</button>
                        <button class="advanced-effect-btn" data-effect="directionalSweep">DirSweep</button>
                    </div>

                    <!-- Classic Effects -->
                    <div class="effect-category-title">Classic</div>
                    <div class="color-effect-buttons">
                        <button class="advanced-effect-btn" data-effect="sparkle">Sparkle</button>
                        <button class="advanced-effect-btn" data-effect="rainbowSweep">Rainbow</button>
                        <button class="advanced-effect-btn" data-effect="fire">Fire</button>
                        <button class="advanced-effect-btn" data-effect="plasma">Plasma</button>
                        <button class="advanced-effect-btn" data-effect="kaleidoscope">Kaleid</button>
                        <button class="advanced-effect-btn" data-effect="breath">Breath</button>
                        <button class="advanced-effect-btn" data-effect="colorChase">Chase</button>
                    </div>

                    <!-- Effect Controls -->
                    <div class="control-group">
                        <label>Effect Intensity <span class="value-display" id="color-effect-intensity-value">1.0</span></label>
                        <input type="range" id="color-effect-intensity" min="0" max="1" step="0.05" value="1.0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        // Connect to Python server
        const socket = io(window.location.origin);

        // Current parameters
        const params = {
            scene_type: 'shapeMorph',
            size: 1.0,
            density: 0.5,
            animationSpeed: 1.0,
            frequency: 1.0,
            amplitude: 0.5,
            objectCount: 1,
            rotationX: 0.0,
            rotationY: 0.0,
            rotationZ: 0.0,
            // Color system
            color_type: 'single',
            color_single: '#64C8FF',
            color_gradient: '#FF0000,#0000FF',
            color_effect: 'none',
            color_effect_intensity: 1.0,
            color_mode: 'rainbow',
            color_speed: 1.0,
            // Global effects
            decay: 0.0,
            strobe: 'off',
            pulse: 'off',
            invert: false,
            scrolling_direction: 'y',
            scrolling_thickness: 0,
            scrolling_invert: false,
            // Scene-specific params
            scene_params: {
                shape: 'sphere',
                waveType: 'ripple',
                pattern: 'particles'
            }
        };

        // Connection status
        socket.on('connect', () => {
            console.log('Connected to server');
            document.getElementById('connection-status').textContent = 'Connected';
            document.getElementById('connection-status').className = 'status-value connected';
            sendParams();
        });

        socket.on('disconnect', () => {
            console.log('Disconnected from server');
            document.getElementById('connection-status').textContent = 'Disconnected';
            document.getElementById('connection-status').className = 'status-value disconnected';
        });

        socket.on('status', (data) => {
            if (data.config) {
                document.getElementById('grid-size').textContent =
                    `${data.config.gridX}×${data.config.gridY}×${data.config.gridZ}`;
            }
        });

        socket.on('stats', (data) => {
            document.getElementById('fps').textContent = data.fps;
            document.getElementById('active-leds').textContent = data.active_leds.toLocaleString();
        });

        function sendParams() {
            const flatParams = {...params, ...params.scene_params};
            socket.emit('update_params', flatParams);
        }

        // Scene selection
        document.querySelectorAll('.scene-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.scene-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                params.scene_type = btn.dataset.scene;
                updateSceneParams(params.scene_type);
                sendParams();
            });
        });

        function updateSceneParams(sceneType) {
            document.getElementById('shape-control').style.display =
                sceneType === 'shapeMorph' ? 'block' : 'none';
            document.getElementById('waveType-control').style.display =
                sceneType === 'waveField' ? 'block' : 'none';
            document.getElementById('pattern-control').style.display =
                sceneType === 'particleFlow' ? 'block' : 'none';
        }

        // Parameter sliders
        function setupSlider(id, param, decimals = 2) {
            const slider = document.getElementById(id);
            const valueDisplay = document.getElementById(`${id}-value`);
            slider.addEventListener('input', (e) => {
                const value = parseFloat(e.target.value);
                valueDisplay.textContent = value.toFixed(decimals);
                params[param] = value;
                sendParams();
            });
        }

        setupSlider('size', 'size', 2);
        setupSlider('density', 'density', 2);
        setupSlider('animationSpeed', 'animationSpeed', 2);
        setupSlider('frequency', 'frequency', 2);
        setupSlider('amplitude', 'amplitude', 2);
        setupSlider('objectCount', 'objectCount', 0);
        setupSlider('rotationX', 'rotationX', 2);
        setupSlider('rotationY', 'rotationY', 2);
        setupSlider('rotationZ', 'rotationZ', 2);
        setupSlider('decay', 'decay', 2);
        setupSlider('color-speed', 'color_speed', 2);
        setupSlider('color-effect-intensity', 'color_effect_intensity', 2);
        setupSlider('scrolling_thickness', 'scrolling_thickness', 0);

        // Color preset buttons
        document.querySelectorAll('.color-preset-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const type = btn.dataset.type;
                if (type === 'single') {
                    document.querySelectorAll('.color-preset-btn[data-type="single"]')
                        .forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    params.color_type = 'single';
                    params.color_single = btn.dataset.color;
                } else if (type === 'gradient') {
                    document.querySelectorAll('.color-preset-btn[data-type="gradient"]')
                        .forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    params.color_type = 'gradient';
                    params.color_gradient = btn.dataset.gradient;
                }
                sendParams();
            });
        });

        // Color mode toggle
        document.querySelectorAll('.toggle-btn[data-mode]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.toggle-btn[data-mode]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                params.color_mode = btn.dataset.mode;
                sendParams();
            });
        });

        // Color effect buttons
        document.querySelectorAll('.color-effect-btn, .advanced-effect-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.color-effect-btn, .advanced-effect-btn')
                    .forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                params.color_effect = btn.dataset.effect;
                sendParams();
            });
        });

        // Global effect buttons
        document.querySelectorAll('.effect-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const param = btn.dataset.param;
                const value = btn.dataset.value;

                // Remove active from current param buttons
                document.querySelectorAll(`.effect-btn[data-param="${param}"]`)
                    .forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                params[param] = value;

                // If activating strobe (not off), deactivate pulse
                if (param === 'strobe' && value !== 'off') {
                    params.pulse = 'off';
                    document.querySelectorAll('.effect-btn[data-param="pulse"]')
                        .forEach(b => b.classList.remove('active'));
                    document.querySelector('.effect-btn[data-param="pulse"][data-value="off"]')
                        .classList.add('active');
                }

                // If activating pulse (not off), deactivate strobe
                if (param === 'pulse' && value !== 'off') {
                    params.strobe = 'off';
                    document.querySelectorAll('.effect-btn[data-param="strobe"]')
                        .forEach(b => b.classList.remove('active'));
                    document.querySelector('.effect-btn[data-param="strobe"][data-value="off"]')
                        .classList.add('active');
                }

                sendParams();
            });
        });

        // Scene-specific selects
        document.getElementById('shape').addEventListener('change', (e) => {
            params.scene_params.shape = e.target.value;
            sendParams();
        });

        document.getElementById('waveType').addEventListener('change', (e) => {
            params.scene_params.waveType = e.target.value;
            sendParams();
        });

        document.getElementById('pattern').addEventListener('change', (e) => {
            params.scene_params.pattern = e.target.value;
            sendParams();
        });

        // Invert toggle buttons
        document.getElementById('invert').addEventListener('click', (e) => {
            e.target.classList.toggle('active');
            params.invert = e.target.classList.contains('active');
            sendParams();
        });

        document.getElementById('scrolling_invert').addEventListener('click', (e) => {
            e.target.classList.toggle('active');
            params.scrolling_invert = e.target.classList.contains('active');
            sendParams();
        });

        // Scrolling direction buttons
        document.querySelectorAll('[data-param="scrolling_direction"]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('[data-param="scrolling_direction"]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                params.scrolling_direction = btn.dataset.value;
                sendParams();
            });
        });

        console.log('Controller UI loaded');
    </script>
</body>
</html>
